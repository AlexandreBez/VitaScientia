<!-- Criar projeto -->
<div class="modal fade" id="modalNovoProjeto" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog" style="margin-left: 16%;">
        <div class="modal-content" style="width: 180%;">
            <div class="modal-header" style="background-color: #76533E;">
                <h1 class="modal-title fs-5 text-white" id="staticBackdropLabel">Novo projeto</h1>
            </div>
            <div class="modal-body text-white" style="background-color: #292F33;">
                <div class="alert alert-warning" id="alert-erro-modal" role="alert" *ngIf="mensagemDeErroModal">
                    <i class="bi bi-exclamation-circle"></i>
                    {{mensagemDeErroModal}}
                </div>
                <div class="alert alert-info" id="alert-sucesso-modal" role="alert" *ngIf="mensagemDeSucessoModal">
                    <i class="bi bi-check-circle"></i>
                    {{mensagemDeSucessoModal}}
                </div>
                <form #formularioNovoProjeto="ngForm">
                    <div class="mb-3">
                        <label for="titulo" class="form-label">Titulo*</label>
                        <input type="text" maxlength="255" class="form-control" id="titulo"
                            placeholder="Titulo do projeto..." name="titulo" #titulo="ngModel" ngModel required>
                    </div>
                    <div class="mb-3">
                        <label for="Descricao" class="form-label">Descrição*</label>
                        <textarea maxlength="65535" class="form-control" id="descricao" rows="10"
                            placeholder="Descrição do projeto..." name="descricao" #descricao="ngModel" ngModel
                            required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="background-color: #76533E;">
                <button type="button" class="btn btn-dark" #fechaNovoProjeto data-bs-dismiss="modal"
                    (click)="formularioNovoProjeto.reset()">
                    <i class="bi bi-x-circle"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-success" id="salvarProjetoBtn"
                    [disabled]="mensagemDeSucessoModal != null || !formularioNovoProjeto.valid"
                    (click)="novoProjeto()">
                    <i class="bi bi-clipboard-plus"></i>
                    Salvar
                </button>
            </div>
        </div>

    </div>
</div>

<!-- Atualiza projeto -->
<div class="modal fade" id="modalAtualizaProjeto" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog" style="margin-left: 16%;">
        <div class="modal-content" style="width: 180%;">
            <div class="modal-header" style="background-color: #76533E;">
                <h1 class="modal-title fs-5 text-white" id="staticBackdropLabel">Atualizar projeto</h1>
            </div>
            <div class="modal-body text-white" style="background-color: #292F33;">
                <div class="alert alert-warning" role="alert" *ngIf="mensagemDeErroModal">
                    <i class="bi bi-exclamation-circle"></i>
                    {{mensagemDeErroModal}}
                </div>
                <div class="alert alert-info" role="alert" *ngIf="mensagemDeSucessoModal">
                    <i class="bi bi-check-circle"></i>
                    {{mensagemDeSucessoModal}}
                </div>
                <form>
                    <div class="mb-3">
                        <label for="status" class="form-label">Status*</label>
                        <select maxlength="255" class="form-control" id="status" placeholder="Selecione o status"
                            name="status" [(ngModel)]="novo_status_projeto">
                            <option *ngFor="let opcao of opcao_status_projeto" [ngValue]="opcao">{{ opcao }}</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="titulo" class="form-label">Titulo*</label>
                        <input type="text" maxlength="255" class="form-control" id="titulo"
                            placeholder="Titulo do projeto..." name="titulo" [(ngModel)]="novo_titulo_projeto">
                    </div>
                    <div class="mb-3">
                        <label for="Descricao" class="form-label">Descrição*</label>
                        <textarea maxlength="65535" class="form-control" id="descricao" rows="10"
                            placeholder="Descrição do projeto..." name="descricao" [(ngModel)]="nova_decricao_projeto">
                        </textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="background-color: #76533E;">
                <button type="button" #fechaEditaProjeto (click)="novo_titulo_projeto = null;nova_decricao_projeto = null"
                    class="btn btn-dark" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="atualizarProjetoBtn"
                    [disabled]="novo_titulo_projeto == null || nova_decricao_projeto == null || mensagemDeSucessoModal != null"
                    (click)="atualizaProjeto()">
                    <i class="bi bi-arrow-repeat"></i>
                    Atualizar
                </button>
            </div>
        </div>

    </div>
</div>

<!-- Deleta projeto -->
<div class="modal fade" id="modalDeletaProjeto" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #76533E;">
                <h1 class="modal-title fs-5 text-white" id="staticBackdropLabel">Deletar projeto</h1>
            </div>
            <div class="modal-body text-white" style="background-color: #292F33;">
                <div class="alert alert-warning" role="alert" *ngIf="mensagemDeErroModal">
                    <i class="bi bi-exclamation-circle"></i>
                    {{mensagemDeErroModal}}
                </div>
                <div class="alert alert-info" role="alert" *ngIf="mensagemDeSucessoModal">
                    <i class="bi bi-check-circle"></i>
                    {{mensagemDeSucessoModal}}
                </div>
                Confirmar ação?
            </div>
            <div class="modal-footer" style="background-color: #76533E;">
                <button type="button" #fechaDeletaProjeto class="btn btn-dark" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-danger" [disabled]="mensagemDeSucessoModal != null"
                    (click)="deletaProjeto()">
                    <i class="bi bi-clipboard-x"></i>
                    Confirmar
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Associa anotação -->
<div class="modal fade" id="associaAnotacaoModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #76533E;">
                <h1 class="modal-title fs-5 text-white" id="staticBackdropLabel">Associar anotação</h1>
            </div>
            <div class="modal-body text-white" style="background-color: #292F33;">
                <div class="alert alert-warning" role="alert" *ngIf="mensagemDeErroModal">
                    <i class="bi bi-exclamation-circle"></i>
                    {{mensagemDeErroModal}}
                </div>
                <div class="alert alert-info" role="alert" *ngIf="mensagemDeSucessoModal">
                    <i class="bi bi-check-circle"></i>
                    {{mensagemDeSucessoModal}}
                </div>
                <div *ngIf="carregando_lista_anotacoes" class="progress" role="progressbar"
                    aria-label="Animated striped example" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar bg-dark progress-bar-striped progress-bar-animated" style="width: 100%">
                    </div>
                </div>
                <div *ngIf="!carregando_lista_anotacoes">
                    <label>Lista de anotacoes</label>
                    <ng-select [items]="lista_anotacoes_nao_associadas" bindLabel="anotacao_titulo" bindValue="id_anotacao" [multiple]="true"
                        placeholder="Selecione as anotacoes" [(ngModel)]="lista_anotacoes_para_associar">
                    </ng-select>
                </div>
            </div>
            <div class="modal-footer" style="background-color: #76533E;">
                <button type="button" class="btn btn-dark" data-bs-dismiss="modal" #fechaAssociaAnotacoes (click)="lista_anotacoes_para_associar = [];limpaMensagens()">
                    <i class="bi bi-x-circle"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-success" [disabled]="lista_anotacoes_para_associar.length < 1 || mensagemDeSucessoModal != null"
                    (click)="associarAnotacoes()">
                    <i class="bi bi-journal-plus"></i>
                    Associar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Desassocia anotação -->
<div class="modal fade" id="desassociaAnotacaoModal" data-bs-backdrop="static" data-bs-keyboard="false"
    tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #76533E;">
                <h1 class="modal-title fs-5 text-white" id="staticBackdropLabel">Desasociar anotação</h1>
            </div>
            <div class="modal-body text-white" style="background-color: #292F33;">
                <div class="alert alert-warning" role="alert" *ngIf="mensagemDeErroModal">
                    <i class="bi bi-exclamation-circle"></i>
                    {{mensagemDeErroModal}}
                </div>
                <div class="alert alert-info" role="alert" *ngIf="mensagemDeSucessoModal">
                    <i class="bi bi-check-circle"></i>
                    {{mensagemDeSucessoModal}}
                </div>
                Confirmar ação?
            </div>
            <div class="modal-footer" style="background-color: #76533E;">
                <button type="button" #fechaDesassociaAnotacoes class="btn btn-dark" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>
                    Cancelar
                </button>
                <button type="button" class="btn btn-danger" (click)="desassociarAnotacoes()">
                    <i class="bi bi-clipboard-minus"></i>
                    Confirmar
                </button>
            </div>
        </div>
    </div>
</div>


<!-- View pesquisa -->
<div class="modal fade" id="detalhesPesquisaModal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel"
    aria-hidden="true">
    <div class="modal-dialog" style="margin-left: 16%;">
        <div class="modal-content" style="width: 180%;">
            <div class="modal-header" style="background-color: #76533E;">
                <h1 class="modal-title fs-5 text-white" id="staticBackdropLabel">
                    #ANT{{detalhes_pesquisa.id_pesquisa}} - {{detalhes_pesquisa.pesquisa_titulo}}</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-white" style="background-color: #292F33;">
                <p class="note-date">Criado em: {{detalhes_pesquisa.data_criacao}}</p>
                <hr>
                <p>{{detalhes_pesquisa.pesquisa_descricao}}</p>
            </div>
        </div>
    </div>
</div>

<!-- View anotacao -->
<div class="modal fade" id="detalhesAnotacaoModal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel"
    aria-hidden="true">
    <div class="modal-dialog" style="margin-left: 16%;">
        <div class="modal-content" style="width: 180%;">
            <div class="modal-header" style="background-color: #76533E;">
                <h1 class="modal-title fs-5 text-white" id="staticBackdropLabel">
                    #ANT{{detalhes_anotacao.id_anotacao}} - {{detalhes_anotacao.anotacao_titulo}}</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-white" style="background-color: #292F33;">
                <p class="note-date">Criado em: {{detalhes_anotacao.data_criacao}}</p>
                <hr>
                <p>{{detalhes_anotacao.anotacao_descricao}}</p>
            </div>
        </div>
    </div>
</div>

<app-spinner *ngIf="carregando"></app-spinner>

<div class="bg-dark ms-5 me-5 mb-5" style="border-radius: 10px;" *ngIf="!carregando">

    <nav class="navbar" style="border: 1px solid #76533E;border-radius: 10px;">
        <div class="container-fluid">

            <form class="d-flex" role="search" #formularioBuscaProjeto="ngForm">

                <button class="btn dropdown-toggle btn-outline me-2" id="filtro" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-funnel"></i>
                </button>

                <ul class="dropdown-menu" style="background-color: #2B2B2B;">

                    <li>
                        <a class="dropdown-item btn-outline" type="button">
                            <div class="form-check">
                                <input [(ngModel)]="filtroSelecionado" (click)="this.formularioBuscaProjeto.reset"
                                    class="form-check-input" value="titulo" type="radio" name="titulo" id="titulo">
                                <label (click)="this.formularioBuscaProjeto.reset" class="form-check-label custom-text"
                                    for="titulo">
                                    <i class="bi bi-clipboard"></i>
                                    Titulo
                                </label>
                            </div>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <a class="dropdown-item btn-outline" type="button">
                            <div class="form-check">
                                <input [(ngModel)]="filtroSelecionado" (click)="this.formularioBuscaProjeto.reset"
                                    class="form-check-input" value="id" type="radio" name="id" id="id">
                                <label (click)="this.formularioBuscaProjeto.reset" class="form-check-label custom-text"
                                    for="id">
                                    <i class="bi bi-hash"></i>
                                    Id
                                </label>
                            </div>
                        </a>
                    </li>

                </ul>
                <div class="input-group" *ngIf="filtroSelecionado == 'id'">
                    <span class="input-group-text" id="basic-addon1">#PJT</span>
                    <input class="form-control me-2" style="width: 200px;" min="1" type="number"
                        placeholder="Pesquisar id" aria-label="Search" id="search_input" name="search_input"
                        #search_input="ngModel" ngModel>
                </div>
                <input class="form-control me-2" style="width: 230px;" list="noteTitles" type="text"
                    placeholder="Pesquisar titulo" aria-label="Search" id="search_input" name="search_input"
                    #search_input="ngModel" ngModel *ngIf="filtroSelecionado == 'titulo'">
                <button class="btn btn-outline-success" id="search_btn" (click)="filtro();index_projeto = null">
                    <i class="bi bi-binoculars"></i>
                </button>
            </form>
            <h3 class="title">Projetos</h3>
            <button class="btn btn-outline" id="novoProjeto" data-bs-toggle="modal" data-bs-target="#modalNovoProjeto">
                <i class="bi bi-folder-plus"></i>
                Novo projeto
            </button>
        </div>
    </nav>

    <div class="alert alert-warning" role="alert" *ngIf="mensagemDeErro">
        <i class="bi bi-exclamation-circle"></i>
        {{mensagemDeErro}}
    </div>
    <div class="alert alert-info" role="alert" *ngIf="mensagemDeSucesso">
        <i class="bi bi-check-circle"></i>
        {{mensagemDeSucesso}}
    </div>

    <div class="container-fluid d-flex justify-content-center align-items-center p-5" style="color: #E28247;"
        *ngIf="dadosProjeto.content.length < 1">
        <img src="/assets/imgs/SemConteudo.svg" alt="Nada encontrado" class="img-fluid" style="width: 40%; height: auto;">
    </div>

    <div class="d-flex flex-row" style="color: #E28247;" *ngIf="dadosProjeto.content.length >= 1">

        <div class="p-2" id="list-menu">

            <div *ngIf="carregandoLista" class="progress" role="progressbar" aria-label="Animated striped example"
                aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar bg-dark progress-bar-striped progress-bar-animated" style="width: 100%"></div>
            </div>

            <nav aria-label="Page navigation" *ngIf="dadosProjeto.totalPages > 1 && pesquisaTitulo == false">
                <ul class="pagination justify-content-center">
                    <!-- Previous normal Page -->
                    <li class="page-item" [class.disabled]="dadosProjeto.first">
                        <a class="page-link" (click)="listaDeProjeto(dadosProjeto.number - 1);index_projeto = null">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>

                    <!-- Page Numbers -->
                    <li class="page-item" *ngFor="let pageIndex of pegaArrayDePaginas(dadosProjeto.totalPages)">
                        <a class="page-link" [class.active]="pageIndex === dadosProjeto.number"
                            (click)="listaDeProjeto(pageIndex);index_projeto = null">
                            {{ pageIndex + 1 }}
                        </a>
                    </li>

                    <!-- Next normal Page -->
                    <li class="page-item" [class.disabled]="dadosProjeto.last">
                        <a class="page-link" (click)="listaDeProjeto(dadosProjeto.number + 1);index_projeto = null">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>

                </ul>
            </nav>

            <nav aria-label="Page navigation" *ngIf="dadosProjeto.totalPages > 1 && pesquisaTitulo == true">
                <ul class="pagination justify-content-center">
                    <!-- Previous normal Page -->
                    <li class="page-item" [class.disabled]="dadosProjeto.first">
                        <a class="page-link"
                            (click)="pesquisaPeloTitulo(dadosProjeto.number - 1);index_projeto = null">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>

                    <!-- Page Numbers -->
                    <li class="page-item" *ngFor="let pageIndex of pegaArrayDePaginas(dadosProjeto.totalPages)">
                        <a class="page-link" [class.active]="pageIndex === dadosProjeto.number"
                            (click)="pesquisaPeloTitulo(pageIndex);index_projeto = null">
                            {{ pageIndex + 1 }}
                        </a>
                    </li>

                    <!-- Next normal Page -->
                    <li class="page-item" [class.disabled]="dadosProjeto.last">
                        <a class="page-link"
                            (click)="pesquisaPeloTitulo(dadosProjeto.number + 1);index_projeto = null">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>

                </ul>
            </nav>

            <ul class="list-group" *ngIf="!carregandoLista" id="lista-projeto">
                <li (click)="conteudoProjeto = dados;index_projeto = i;conta_os_dados_grafico_pesquisa_e_apresenta(dados.pesquisa);"
                    value="{{dados.projeto_titulo}}" [class.custom-border]="index_projeto == i"
                    class="list-group-item list-group-item-action" type="button"
                    *ngFor="let dados of dadosProjeto.content;let i = index">
                    <button [disabled]="index_projeto != i" class="btn btn-outline-danger me-1" data-bs-toggle="modal"
                        data-bs-target="#modalDeletaProjeto" [id]="'deleta_projeto_'+dados.id_projeto"
                        (click)="id_projeto = dados.id_projeto;index_projeto = i">
                        <i class="bi bi-trash"></i>
                    </button>
                    #PJT{{dados.id_projeto}} - {{dados.projeto_titulo}}
                </li>
            </ul>
        </div>

        <div class="p-2 container-fluid note-content" id="conteudo_projeto">
            <div *ngIf="conteudoProjeto != null">
                <h3 class="text-center" id="projeto_titulo">
                    #PJT{{conteudoProjeto.id_projeto}} - {{conteudoProjeto.projeto_titulo}}
                    <button
                        (click)="novo_titulo_projeto = conteudoProjeto.projeto_titulo; nova_decricao_projeto = conteudoProjeto.projeto_descricao; novo_status_projeto = conteudoProjeto.status; id_projeto = conteudoProjeto.id_projeto;"
                        class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalAtualizaProjeto" id="atualiza_projeto">
                        <i class="bi bi-pencil-square"></i>
                    </button>
                </h3>
                <h6 class="note-date text-center">Criado em: {{conteudoProjeto.data_criacao}} | Status: {{conteudoProjeto.status}}</h6>
                <hr>
                <h4>Descrição</h4>
                <p id="projeto_descricao">{{conteudoProjeto.projeto_descricao}}</p>
                <hr>
                <h4>
                    Pesquisas associadas
                </h4>
                <table class="table table-dark table-bordless table-hover" *ngIf="!conteudoProjeto.pesquisa == undefined || conteudoProjeto.pesquisa.length > 0">
                    <thead>
                        <tr>
                            <th scope="col">
                                ID
                            </th>
                            <th scope="col">
                                Pesquisa
                            </th>
                            <th scope="col">
                                Status
                            </th>
                            <th scope="col">
                                Criado em
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let pesquisa of conteudoProjeto.pesquisa;let i = index">
                            <td>
                                #PQS{{pesquisa.id_pesquisa}}
                            </td>
                            <td>
                                <button class="btn btn-link text-decoration-none" (click)="detalhes_pesquisa = pesquisa" data-bs-toggle="modal"
                                    data-bs-target="#detalhesPesquisaModal">
                                    {{pesquisa.pesquisa_titulo}}
                                </button>
                            </td>
                            <td>
                                {{pesquisa.status}}
                            </td>
                            <td>
                                {{pesquisa.data_criacao}}
                            </td>
                        </tr>
                    </tbody>
                </table>
                <apx-chart 
                    *ngIf="!conteudoProjeto.pesquisa == undefined || conteudoProjeto.pesquisa.length > 0"
                    id="graficoStatus"
                    [series]="chartOptionsPesquisas.series" 
                    [chart]="chartOptionsPesquisas.chart"
                    [labels]="chartOptionsPesquisas.labels"
                    [responsive]="chartOptionsPesquisas.responsive"
                    [dataLabels]="chartOptionsPesquisas.dataLabels" 
                    [tooltip]="chartOptionsPesquisas.tooltip"
                    [legend]="chartOptionsPesquisas.legend"
                />
                <hr>
                <h4>
                    Anotações associadas
                    <button class="btn btn-outline-success ms-2"
                        (click)="id_projeto = conteudoProjeto.id_projeto;anotacoesNaoAssociadas()"
                        data-bs-toggle="modal" data-bs-target="#associaAnotacaoModal">
                        <i class="bi bi-bookmark-plus"></i>
                    </button>
                </h4>
                <table class="table table-dark table-bordless table-hover"
                    *ngIf="!conteudoProjeto.anotacao == undefined || conteudoProjeto.anotacao.length > 0">
                    <thead>
                        <tr>
                            <th scope="col">
                                ID
                            </th>
                            <th scope="col">
                                Anotação
                            </th>
                            <th scope="col">
                                Criado em
                            </th>
                            <th scope="col" class="text-center">
                                Desassociar
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let anotacao of conteudoProjeto.anotacao;let i = index">
                            <td>
                                #ANT{{anotacao.id_anotacao}}
                            </td>
                            <td>
                                <button class="btn btn-link text-decoration-none" (click)="detalhes_anotacao = anotacao" data-bs-toggle="modal"
                                    data-bs-target="#detalhesAnotacaoModal">
                                    {{anotacao.anotacao_titulo}}
                                </button>
                            </td>
                            <td>
                                {{anotacao.data_criacao}}
                            </td>
                            <td class="text-center">
                                <button class="btn btn-outline" data-bs-toggle="modal"
                                    data-bs-target="#desassociaAnotacaoModal"
                                    (click)="id_anotacao = anotacao.id_anotacao; id_projeto = conteudoProjeto.id_projeto;index_anotacao = i">
                                    <i class="bi bi-bookmark-dash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>

    </div>

</div>